# Ingestor Plugin Configuration
# The ingestor plugin discovers and imports Kubernetes resources into the Backstage catalog

# Kubernetes Ingestor configuration
kubernetesIngestor:
  # Mappings of kubernetes resource metadata to backstage entity metadata
  mappings:
    namespaceModel: 'namespace'       # Options: cluster, namespace, default
    nameModel: 'name-cluster'         # Options: name-cluster, name-namespace, name
    titleModel: 'name'                # Options: name, name-cluster, name-namespace
    systemModel: 'cluster'            # Options: cluster, namespace, cluster-namespace, default

  # Component ingestion settings
  components:
    enabled: true
    taskRunner:
      frequency: 10  # How often to query clusters (in seconds)
      timeout: 600   # Max processing time
    excludedNamespaces:
      - kube-public
      - kube-system
      - kube-node-lease
      - flux-system
      - crossplane-system
      - backstage-system
      - calico-system
      - calico-apiserver
      - tigera-operator
      - ingress-nginx
      - external-dns
      - cert-manager
      - kubernetes-dashboard

  # Crossplane XRD template generation
  crossplane:
    enabled: true
    claims:
      # Ingest all claims and XRs from the cluster
      ingestAllClaims: true
    xrds:
      enabled: true
      ingestAllXRDs: true  # Ingest all XRDs with the label
      # Only ingest XRDs with this label (if ingestAllXRDs is false)
      labelSelector: 'openportal.dev/tags'
      # The label that contains tags for the templates
      tagsLabel: 'openportal.dev/tags'
      # Default namespace for XR templates
      defaultNamespace: 'demo'