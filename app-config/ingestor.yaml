# Ingestor Plugin Configuration
# The ingestor plugin discovers and imports Kubernetes resources into the Backstage catalog

# Kubernetes Ingestor configuration
kubernetesIngestor:
  # Mappings of kubernetes resource metadata to backstage entity metadata
  mappings:
    namespaceModel: 'namespace'       # Options: cluster, namespace, default
    nameModel: 'name-cluster'         # Options: name-cluster, name-namespace, name
    titleModel: 'name'                # Options: name, name-cluster, name-namespace
    systemModel: 'cluster'            # Options: cluster, namespace, cluster-namespace, default

  # Component ingestion settings
  components:
    enabled: true
    taskRunner:
      frequency: 20  # How often to query clusters (in seconds)
      timeout: 600   # Max processing time
    excludedNamespaces:
      - kube-public
      - kube-system
      - kube-node-lease
      - flux-system
      - crossplane-system
      - backstage-system
      - calico-system
      - calico-apiserver
      - tigera-operator
      - ingress-nginx
      - external-dns
      - cert-manager
      - kubernetes-dashboard

  # Crossplane XRD template generation
  crossplane:
    enabled: true
    claims:
      # Ingest all claims and XRs from the cluster
      ingestAllClaims: true
    xrds:
      enabled: true
      ingestAllXRDs: true  # Ingest all XRDs with the label
      # Only ingest XRDs with this label (if ingestAllXRDs is false)
      # labelSelector: 'openportal.dev/add-to-catalog'
      
      taskRunner:
        frequency: 20  # How often to regenerate templates from XRDs (in seconds)
        timeout: 600   # Max processing time
      
      # GitOps configuration for template generation
      gitops:
        # Repository where XR instances are created via PRs
        owner: 'open-service-portal'
        repo: 'catalog-orders'
        targetBranch: 'main'