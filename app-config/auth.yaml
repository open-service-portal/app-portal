# Authentication configuration
# This file contains all authentication-related settings

auth:
  # see https://backstage.io/docs/auth/ to learn about auth providers
  environment: development
  providers:
    # See https://backstage.io/docs/auth/guest/provider
    guest:
      # Give guest users a specific identity that has read permissions
      userEntityRef: user:default/guest
      ownershipEntityRefs: 
        - user:default/guest
        - group:default/all-users
    github:
      development:
        clientId: ${AUTH_GITHUB_CLIENT_ID}
        clientSecret: ${AUTH_GITHUB_CLIENT_SECRET}
        signIn:
          resolvers:
            # Matches the GitHub username with the Backstage user entity name.
            # See https://backstage.io/docs/auth/github/provider#resolvers for more resolvers.
            - resolver: usernameMatchingUserEntityName

    # Custom OIDC PKCE Provider for Kubernetes cluster access
    # This is a custom provider that supports PKCE for public clients
    # See packages/backend/src/auth-providers/oidc-pkce-authenticator.ts
    oidc:
      development:
        metadataUrl: https://login.spot.rackspace.com/.well-known/openid-configuration
        clientId: mwG3lUMV8KyeMqHe4fJ5Bb3nM1vBvRNa
        # No clientSecret needed - will use PKCE automatically
        prompt: auto
        # Additional auth request parameters for Rackspace multi-tenant
        additionalAuthParams:
          - key: organization
            value: org_zOuCBHiyF1yG8d1D
        signIn:
          resolvers:
            # Use email claim for identity matching
            # JWT claim "email" matches Backstage user entity spec.profile.email
            # See concepts/2025-10-23-oidc-kubernetes-authentication.md for details
            - resolver: emailMatchingUserEntityProfileEmail

# Cluster Authentication Configuration
# Backend plugin for storing OIDC tokens from oidc-authenticator daemon
#
# The backend doesn't need to know about the OIDC provider details -
# it just receives already-validated tokens from the daemon.
# However, providing the issuer allows optional JWT validation for extra security.
#
# See oidc-authenticator/docs/backstage-integration.md for details
clusterAuth:
  issuer: https://login.spot.rackspace.com/  # Optional: for JWT validation
  verifySignature: false  # Set to true for production JWT signature verification