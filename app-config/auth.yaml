# Authentication configuration
# This file contains all authentication-related settings

auth:
  # see https://backstage.io/docs/auth/ to learn about auth providers
  environment: development
  providers:
    # See https://backstage.io/docs/auth/guest/provider
    guest:
      # Give guest users a specific identity that has read permissions
      userEntityRef: user:default/guest
      ownershipEntityRefs: 
        - user:default/guest
        - group:default/all-users
    github:
      development:
        clientId: ${AUTH_GITHUB_CLIENT_ID}
        clientSecret: ${AUTH_GITHUB_CLIENT_SECRET}
        # GitHub is used for OAuth token access only (creating PRs, commits)
        # Users authenticate via Microsoft Entra ID for Backstage identity
        signIn:
          resolvers:
            - resolver: usernameMatchingUserEntityName
              dangerouslyAllowSignInWithoutUserInCatalog: true
    microsoft:
      development:
        clientId: ${AUTH_MICROSOFT_CLIENT_ID}
        clientSecret: ${AUTH_MICROSOFT_CLIENT_SECRET}
        tenantId: ${AUTH_MICROSOFT_TENANT_ID}
        domainHint: ${AUTH_MICROSOFT_TENANT_ID}
        # See https://backstage.io/docs/auth/microsoft/provider for more configuration options
        signIn:
          resolvers:
            # See https://backstage.io/docs/auth/microsoft/provider#resolvers for more resolvers
            - resolver: userIdMatchingUserEntityAnnotation
    # Kubernetes OIDC authentication provider
    # Used for Kubernetes API token access only (not for user login)
    # Similar to GitHub provider - available for API calls but not shown on SignInPage
    kubernetes:
      development:
        issuer: ${AUTH_KUBERNETES_ISSUER}
        clientId: ${AUTH_KUBERNETES_CLIENT_ID}
        clientSecret: ${AUTH_KUBERNETES_CLIENT_SECRET}
        # Note: No signIn resolvers - this provider is for API tokens only