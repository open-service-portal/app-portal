<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Backstage is an open source framework for building developer portals"
    />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link
      rel="manifest"
      href="<%= publicPath %>/manifest.json"
      crossorigin="use-credentials"
    />
    <link rel="icon" href="<%= publicPath %>/favicon.ico" />
    <link rel="shortcut icon" href="<%= publicPath %>/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="<%= publicPath %>/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="<%= publicPath %>/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="<%= publicPath %>/favicon-16x16.png"
    />
    <link
      rel="mask-icon"
      href="<%= publicPath %>/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <title><%= config.getOptionalString('app.title') ?? 'Backstage' %></title>
    <script>
      // Force mobile filter drawer only on specific pages
      const originalMatchMedia = window.matchMedia;
      
      // Allow-list: Pages where we want mobile filters
      const MOBILE_FILTER_PAGES = [
        '/catalog',   // Catalog and all sub-pages
        '/create'     // Template selection page
      ];
      
      // Check if current page should have mobile filters
      function shouldUseMobileFilters() {
        const path = window.location.pathname;
        return MOBILE_FILTER_PAGES.some(page => path.startsWith(page));
      }
      
      window.matchMedia = function(query) {
        // Only apply overrides if we're on a page that needs mobile filters
        if (shouldUseMobileFilters()) {
          // Force mobile view for filter component (md and lg-1 breakpoints)
          if (query.includes('max-width') && (query.includes('959.95') || query.includes('960') || query.includes('1279.95'))) {
            const listeners = [];
            return {
              matches: true,  // Always true = always mobile
              media: query,
              addListener: (fn) => listeners.push(fn),
              removeListener: (fn) => {
                const idx = listeners.indexOf(fn);
                if (idx > -1) listeners.splice(idx, 1);
              },
              addEventListener: (type, fn) => {
                if (type === 'change') listeners.push(fn);
              },
              removeEventListener: (type, fn) => {
                if (type === 'change') {
                  const idx = listeners.indexOf(fn);
                  if (idx > -1) listeners.splice(idx, 1);
                }
              },
              dispatchEvent: () => true
            };
          }
          // Also force lg to be false on these pages
          if (query.includes('min-width') && query.includes('1280')) {
            return {
              matches: false,  // Never desktop
              media: query,
              addListener: () => {},
              removeListener: () => {},
              addEventListener: () => {},
              removeEventListener: () => {},
              dispatchEvent: () => true
            };
          }
        }
        
        // For all other pages/queries, use original behavior
        return originalMatchMedia.call(window, query);
      };
      
      // Debug log
      console.log('[MobileFilters] Active on:', window.location.pathname, '?', shouldUseMobileFilters());
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `yarn start`.
      To create a production bundle, use `yarn build`.
    -->
  </body>
</html>
