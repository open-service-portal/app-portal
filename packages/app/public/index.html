<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Backstage is an open source framework for building developer portals"
    />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link
      rel="manifest"
      href="<%= publicPath %>/manifest.json"
      crossorigin="use-credentials"
    />
    <link rel="icon" href="<%= publicPath %>/favicon.ico" />
    <link rel="shortcut icon" href="<%= publicPath %>/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="<%= publicPath %>/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="<%= publicPath %>/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="<%= publicPath %>/favicon-16x16.png"
    />
    <link
      rel="mask-icon"
      href="<%= publicPath %>/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <title><%= config.getOptionalString('app.title') ?? 'Backstage' %></title>
    <script>
      // Force mobile filter drawer only on specific pages
      const originalMatchMedia = window.matchMedia;
      
      // Allow-list: Pages where we want mobile filters
      const MOBILE_FILTER_PAGES = [
        '/catalog',   // Catalog and all sub-pages
        '/create'     // Template selection page
      ];
      
      // MUI v5 breakpoint values (px)
      // These match Material-UI's theme.breakpoints.down() implementation
      const MUI_BREAKPOINTS = {
        xs: 0,
        sm: 600,
        md: 900,  // up('md') starts here
        lg: 1200, // up('lg') starts here
        xl: 1536
      };
      
      // MUI's breakpoints.down() uses the NEXT breakpoint minus 0.05
      // down('md') = up('lg') - 0.05 = 1200 - 0.05 = 1199.95... BUT
      // Backstage seems to use different values, so we use the actual observed values
      const BREAKPOINT_DOWN_MD = '959.95';   // Actual value used by Backstage
      const BREAKPOINT_DOWN_LG = '1279.95';  // Actual value used by Backstage
      
      // Check if current page should have mobile filters
      function shouldUseMobileFilters() {
        const path = window.location.pathname;
        return MOBILE_FILTER_PAGES.some(page => path.startsWith(page));
      }
      
      window.matchMedia = function(query) {
        // Only apply overrides if we're on a page that needs mobile filters
        if (shouldUseMobileFilters()) {
          // Force mobile view for filter component (md and lg breakpoints)
          // Check for the exact values used by Backstage
          if (query.includes('max-width') && 
              (query.includes(BREAKPOINT_DOWN_MD) || 
               query.includes('960') ||  // Sometimes rounded
               query.includes(BREAKPOINT_DOWN_LG))) {
            const listeners = [];
            return {
              matches: true,  // Always true = always mobile
              media: query,
              addListener: (fn) => listeners.push(fn),
              removeListener: (fn) => {
                const idx = listeners.indexOf(fn);
                if (idx > -1) listeners.splice(idx, 1);
              },
              addEventListener: (type, fn) => {
                if (type === 'change') listeners.push(fn);
              },
              removeEventListener: (type, fn) => {
                if (type === 'change') {
                  const idx = listeners.indexOf(fn);
                  if (idx > -1) listeners.splice(idx, 1);
                }
              },
              dispatchEvent: () => true
            };
          }
          // Also force lg to be false on these pages
          if (query.includes('min-width') && query.includes('1280')) {
            return {
              matches: false,  // Never desktop
              media: query,
              addListener: () => {},
              removeListener: () => {},
              addEventListener: () => {},
              removeEventListener: () => {},
              dispatchEvent: () => true
            };
          }
        }
        
        // For all other pages/queries, use original behavior
        return originalMatchMedia.call(window, query);
      };
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `yarn start`.
      To create a production bundle, use `yarn build`.
    -->
  </body>
</html>
